<div class="min-h-screen bg-slate-50 dark:bg-slate-950 p-6">
  <div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="mb-6">
      <h1 class="text-3xl font-bold text-slate-900 dark:text-white mb-2">
        {{ 'calendar.title' | translate }}
      </h1>
      <p class="text-slate-600 dark:text-slate-400">
        {{ 'calendar.subtitle' | translate }}
      </p>
    </div>

    <!-- Controls -->
    <div class="bg-white dark:bg-slate-900 rounded-lg shadow-sm p-4 mb-6">
      <div class="flex flex-wrap items-center justify-between gap-4">
        <!-- Month Navigation -->
        <div class="flex items-center gap-2">
          <button
            (click)="previousMonth()"
            class="px-4 py-2 bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 rounded-lg transition-colors"
          >
            <span class="text-slate-700 dark:text-slate-300">←</span>
          </button>
          <button
            (click)="todayView()"
            class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors font-medium"
          >
            Hoy
          </button>
          <button
            (click)="nextMonth()"
            class="px-4 py-2 bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 rounded-lg transition-colors"
          >
            <span class="text-slate-700 dark:text-slate-300">→</span>
          </button>
          <h2 class="text-xl font-semibold text-slate-900 dark:text-white ml-4">
            {{ currentMonth() }}
          </h2>
        </div>

        <!-- Team Filter & Create Button -->
        <div class="flex items-center gap-3">
          <select
            [value]="selectedTeamId() || ''"
            (change)="filterByTeam($any($event.target).value || null)"
            class="px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white"
          >
            <option value="">Todos los equipos</option>
            @for (team of teams(); track team.id) {
              <option [value]="team.id">{{ team.name }}</option>
            }
          </select>

          <button
            (click)="openEventForm()"
            class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors font-medium"
          >
            + Crear Evento
          </button>
        </div>
      </div>
    </div>

    <!-- Calendar Grid -->
    <div class="bg-white dark:bg-slate-900 rounded-lg shadow-sm overflow-hidden">
      <!-- Week Days Header -->
      <div class="grid grid-cols-7 border-b border-slate-200 dark:border-slate-700">
        @for (day of ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb']; track day) {
          <div
            class="p-3 text-center text-sm font-semibold text-slate-700 dark:text-slate-300 bg-slate-50 dark:bg-slate-800"
          >
            {{ day }}
          </div>
        }
      </div>

      <!-- Calendar Days -->
      <div class="grid grid-cols-7">
        @for (day of calendarDays(); track day.date.toISOString()) {
          <div
            (click)="onDayClick(day)"
            class="min-h-[120px] border-b border-r border-slate-200 dark:border-slate-700 p-2 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors"
            [class.bg-slate-100]="!day.isCurrentMonth"
            [class.dark:bg-slate-800]="!day.isCurrentMonth"
            [class.ring-2]="isToday(day.date)"
            [class.ring-blue-500]="isToday(day.date)"
          >
            <!-- Day Number -->
            <div
              class="text-sm font-medium mb-1"
              [class.text-slate-400]="!day.isCurrentMonth"
              [class.text-slate-900]="day.isCurrentMonth"
              [class.dark:text-slate-500]="!day.isCurrentMonth"
              [class.dark:text-white]="day.isCurrentMonth"
              [class.text-blue-600]="isToday(day.date)"
              [class.dark:text-blue-400]="isToday(day.date)"
            >
              {{ day.date.getDate() }}
            </div>

            <!-- Events -->
            <div class="space-y-1">
              @for (event of day.events; track event.id) {
                <div
                  (click)="$event.stopPropagation()"
                  class="text-xs p-1.5 rounded border-l-2 cursor-pointer hover:opacity-80 transition-opacity"
                  [class.bg-blue-50]="!event.isCompleted"
                  [class.dark:bg-blue-900/20]="!event.isCompleted"
                  [class.border-blue-500]="!event.isCompleted"
                  [class.bg-green-50]="event.isCompleted"
                  [class.dark:bg-green-900/20]="event.isCompleted"
                  [class.border-green-500]="event.isCompleted"
                >
                  <div class="flex items-center justify-between gap-1">
                    <div class="flex-1 min-w-0">
                      <div class="font-medium truncate text-slate-900 dark:text-white">
                        {{ event.workoutName }}
                      </div>
                      <div class="text-slate-600 dark:text-slate-400 truncate">
                        {{ event.teamName }}
                      </div>
                      <div class="text-slate-500 dark:text-slate-500">
                        {{
                          event.scheduledDate.toLocaleTimeString('es', {
                            hour: '2-digit',
                            minute: '2-digit'
                          })
                        }}
                        ({{ event.durationMinutes }}min)
                      </div>
                    </div>
                    <div class="flex flex-col gap-1">
                      <button
                        (click)="toggleCompletion(event)"
                        class="text-slate-600 dark:text-slate-400 hover:text-green-600 dark:hover:text-green-400"
                        title="Toggle completion"
                      >
                        {{ event.isCompleted ? '✓' : '○' }}
                      </button>
                      <button
                        (click)="confirmDelete(event)"
                        class="text-slate-600 dark:text-slate-400 hover:text-red-600 dark:hover:text-red-400"
                        title="Eliminar"
                      >
                        ×
                      </button>
                    </div>
                  </div>
                </div>
              }
            </div>
          </div>
        }
      </div>
    </div>
  </div>

  <!-- Create Event Form Modal -->
  @if (showEventForm()) {
    <div class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
      <div class="bg-white dark:bg-slate-900 rounded-lg shadow-xl max-w-md w-full">
        <div class="p-6 border-b border-slate-200 dark:border-slate-700">
          <h3 class="text-xl font-semibold text-slate-900 dark:text-white">Crear Evento</h3>
        </div>
        <div class="p-6">
          <app-dynamic-form
            [isOpen]="showEventForm()"
            [title]="'Crear Evento'"
            [config]="formConfig()"
            (formSubmit)="onFormSubmit($event)"
            (cancel)="closeEventForm()"
          ></app-dynamic-form>
        </div>
      </div>
    </div>
  }

  <!-- Delete Confirmation Dialog -->
  @if (showDeleteConfirm()) {
    <app-confirmation-dialog
      [title]="'Eliminar Evento'"
      [message]="'¿Estás seguro de que quieres eliminar este evento?'"
      (confirmed)="deleteEvent()"
      (cancelled)="showDeleteConfirm.set(false)"
    ></app-confirmation-dialog>
  }
</div>
