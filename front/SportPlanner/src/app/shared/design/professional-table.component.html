<div class="professional-table-wrapper bg-white dark:bg-slate-800 rounded-lg shadow-lg p-4">
  <!-- Header -->
  <header class="flex items-center justify-between mb-4">
    <div class="flex items-center gap-4">
      <div *ngIf="showSearch" class="relative">
        <input
          type="text"
          placeholder="Buscar en la tabla..."
          class="pl-10 pr-4 py-2 rounded-full bg-slate-100 dark:bg-slate-700 text-sm focus:ring-2 focus:ring-indigo-500 outline-none"
          [value]="searchTerm()"
          (input)="searchTerm.set($any($event.target).value)"
        />
        <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /></svg>
      </div>
    </div>
    <div class="flex items-center gap-2">
      <button *ngIf="columnFilters().size > 0" (click)="clearFilters()" class="text-sm text-indigo-600 dark:text-indigo-400 hover:underline">Limpiar filtros</button>
    </div>
  </header>

  <!-- Table -->
  <div class="overflow-x-auto">
    <table class="min-w-full table-auto border-separate" style="border-spacing: 0;">
      <thead [class.sticky-header]="stickyHeader">
        <tr class="text-left text-slate-600 dark:text-slate-300 text-sm font-semibold">
          <th *ngIf="actions.length > 0" class="p-3 w-12 text-center">
            <input type="checkbox" class="rounded" [checked]="isAllSelected()" (change)="toggleAllRows()" />
          </th>
          <th *ngFor="let col of columns"
              class="p-3"
              [style.width]="col.width"
              [class.sortable]="col.sortable"
              (click)="toggleSort(col)">
            {{ col.label }}
            <span *ngIf="sortColumn() === col.key">{{ sortDirection() === 'asc' ? '▲' : '▼' }}</span>
          </th>
          <th *ngIf="actions.length > 0" class="p-3 text-right sticky right-0 bg-white dark:bg-slate-800">Acciones</th>
        </tr>
      </thead>
      <tbody *ngIf="!loading">
        <ng-container *ngIf="paginatedData().length > 0; else emptyState">
          <tr *ngFor="let row of paginatedData(); let i = index"
              class="border-t border-slate-200 dark:border-slate-700 transition-colors"
              [class.hoverable]="hoverable"
              [class.striped]="striped && i % 2 !== 0"
              (click)="onRowClick(row)">
            <td *ngIf="actions.length > 0" class="p-3 text-center">
              <input type="checkbox" class="rounded" [checked]="isRowSelected(row)" (change)="toggleRowSelection(row); $event.stopPropagation()" />
            </td>
            <td *ngFor="let col of columns" class="p-3" [ngClass]="getCellClass(row, col)">
              <!-- Different cell types -->
              <ng-container [ngSwitch]="col.type">
                <div *ngSwitchCase="'badge'" class="inline-flex px-2 py-1 rounded-full text-xs font-medium" [ngClass]="col.cellClass ? col.cellClass(row) : ''">
                  {{ formatCell(row, col) }}
                </div>
                <div *ngSwitchCase="'avatar'" class="flex items-center gap-3">
                  <img [src]="getCellValue(row, col.key)" class="w-8 h-8 rounded-full object-cover" />
                  <span>{{ formatCell(row, col) }}</span>
                </div>
                <div *ngSwitchDefault>{{ formatCell(row, col) }}</div>
              </ng-container>
            </td>
            <td *ngIf="actions.length > 0" class="p-3 text-right sticky right-0 bg-white dark:bg-slate-800">
              <div class="flex items-center justify-end gap-2">
                <ng-container *ngFor="let action of actions">
                  <button *ngIf="shouldShowAction(action, row)"
                          (click)="action.onClick(row); $event.stopPropagation()"
                          [title]="action.label"
                          [ngClass]="getActionClass(action)">
                    <i [class]="action.icon"></i>
                  </button>
                </ng-container>
              </div>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>

  <!-- Loading & Empty States -->
  <div *ngIf="loading" class="text-center p-8">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500 mx-auto"></div>
    <p class="mt-4 text-slate-500">Cargando datos...</p>
  </div>
  <ng-template #emptyState>
    <div class="text-center p-8">
      <svg class="mx-auto h-12 w-12 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
      <p class="mt-4 text-slate-500">{{ emptyMessage }}</p>
    </div>
  </ng-template>

  <!-- Pagination -->
  <footer class="flex items-center justify-between pt-4 border-t border-slate-200 dark:border-slate-700">
    <div class="text-sm text-slate-500">
      <span *ngIf="pagination.showTotal">
        Mostrando {{ paginatedData().length }} de {{ filteredData().length }} resultados
      </span>
    </div>
    <div class="flex items-center gap-2">
      <select [value]="pageSize()" (change)="changePageSize(+$any($event.target).value)" class="rounded-md bg-slate-100 dark:bg-slate-700 p-2 text-sm">
        <option *ngFor="let size of pagination.pageSizeOptions" [value]="size">{{ size }} / página</option>
      </select>
      <div class="flex items-center gap-1">
        <button (click)="goToPage(1)" [disabled]="currentPage() === 1" class="pagination-btn">&laquo;</button>
        <button (click)="goToPage(currentPage() - 1)" [disabled]="currentPage() === 1" class="pagination-btn">&lsaquo;</button>
        <ng-container *ngFor="let page of pageNumbers()">
          <button *ngIf="page > 0" (click)="goToPage(page)" [class.active]="currentPage() === page" class="pagination-btn">{{ page }}</button>
          <span *ngIf="page === -1" class="px-2 text-slate-400">...</span>
        </ng-container>
        <button (click)="goToPage(currentPage() + 1)" [disabled]="currentPage() === totalPages()" class="pagination-btn">&rsaquo;</button>
        <button (click)="goToPage(totalPages())" [disabled]="currentPage() === totalPages()" class="pagination-btn">&raquo;</button>
      </div>
    </div>
  </footer>
</div>