@if (isOpen) {
  <div class="fixed inset-0 z-[55] flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in" (click)="onClose()">
    <div class="relative bg-white dark:bg-slate-800 rounded-2xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] flex flex-col animate-slide-up" (click)="$event.stopPropagation()">
      <!-- Modal Header -->
      <div class="flex-shrink-0 flex items-center justify-between px-6 py-4 border-b border-slate-200 dark:border-slate-700">
        <div>
          <h2 class="text-xl font-bold text-slate-900 dark:text-white">
            {{ isEditMode() ? 'Editar objetivo' : 'Agregar objetivo' }}
          </h2>
          <p class="text-sm text-slate-600 dark:text-slate-400 mt-1">
            {{ isEditMode() ? 'Modifica la configuración del objetivo' : 'Selecciona un objetivo y configura sus parámetros' }}
          </p>
        </div>
        <button (click)="onClose()" class="p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors" title="Cerrar">
          <svg class="w-6 h-6 text-slate-600 dark:text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <!-- Modal Body -->
      <div class="flex-1 overflow-y-auto px-6 py-4">
        <!-- Goal Selection (only in add mode) -->
        @if (!isEditMode()) {
          <div class="space-y-2 mb-6">
            <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300">
              Objetivo *
            </label>
            <select
              [value]="selectedGoalId() || ''"
              (change)="onGoalSelect($any($event.target).value)"
              class="w-full px-4 py-3 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
              required>
              <option value="">-- Selecciona un objetivo --</option>
              @for (g of availableGoals; track g.id) {
                <option [value]="g.id">
                  {{ g.name }}
                </option>
              }
            </select>
            @if (selectedGoal()) {
              <p class="text-sm text-slate-600 dark:text-slate-400 mt-2">
                {{ selectedGoal()?.description }}
              </p>
            }
          </div>
        }

        <!-- Goal Info (in edit mode) -->
        @if (isEditMode() && goal) {
          <div class="mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg">
            <div class="flex items-center gap-3 mb-2">
              <svg class="w-5 h-5 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <h3 class="text-lg font-semibold text-slate-900 dark:text-white">{{ goal.name }}</h3>
            </div>
            @if (goal.description) {
              <p class="text-sm text-slate-600 dark:text-slate-400">
                {{ goal.description }}
              </p>
            }
          </div>
        }

        <!-- Priority Selector -->
        <div class="space-y-2 mb-6">
          <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300">
            Prioridad
            <span [class]="getPriorityColor(priority())" class="ml-2 font-semibold">
              {{ getPriorityLabel(priority()) }}
            </span>
          </label>

          <div class="space-y-2">
            <input
              type="range"
              min="1"
              max="10"
              [value]="priority()"
              (input)="onPriorityChange(+$any($event.target).value)"
              class="priority-slider w-full h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer" />

            <div class="flex justify-between text-xs text-slate-500 dark:text-slate-400">
              <span>1 (Baja)</span>
              <span>5 (Media)</span>
              <span>10 (Crítica)</span>
            </div>
          </div>

          <p class="text-sm text-slate-600 dark:text-slate-400">
            Define la importancia de este objetivo
          </p>
        </div>

        <!-- Target Sessions -->
        <div class="space-y-2 mb-6">
          <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300" for="targetSessions">
            Sesiones objetivo
          </label>
          <input
            id="targetSessions"
            type="number"
            min="0"
            [value]="targetSessions()"
            (input)="onTargetSessionsChange(+$any($event.target).value)"
            class="w-full px-4 py-3 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-900 text-slate-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
            placeholder="0" />
          <p class="text-sm text-slate-600 dark:text-slate-400">
            Número de sesiones dedicadas a este objetivo (0 = sin límite)
          </p>
        </div>

        <!-- Summary Card -->
        @if (selectedGoal()) {
          <div class="p-4 bg-slate-50 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded-lg">
            <h4 class="text-sm font-semibold text-slate-900 dark:text-white mb-3">Resumen</h4>
            <div class="space-y-2">
              <div class="flex justify-between items-center">
                <span class="text-sm text-slate-600 dark:text-slate-400">Objetivo:</span>
                <span class="text-sm font-medium text-slate-900 dark:text-white">{{ selectedGoal()?.name }}</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-sm text-slate-600 dark:text-slate-400">Prioridad:</span>
                <span [class]="getPriorityColor(priority())" class="text-sm font-semibold">
                  {{ getPriorityLabel(priority()) }}
                </span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-sm text-slate-600 dark:text-slate-400">Sesiones:</span>
                <span class="text-sm font-medium text-slate-900 dark:text-white">
                  {{ targetSessions() > 0 ? targetSessions() + ' sesiones' : 'Sin límite' }}
                </span>
              </div>
            </div>
          </div>
        }
      </div>

      <!-- Modal Footer -->
      <div class="flex-shrink-0 flex justify-end gap-3 px-6 py-4 border-t border-slate-200 dark:border-slate-700">
        <button 
          (click)="onClose()" 
          class="px-6 py-2.5 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-200 font-semibold rounded-lg transition-colors">
          Cancelar
        </button>
        <button
          (click)="onSave()"
          [disabled]="!canSave()"
          class="inline-flex items-center gap-2 px-6 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-blue-600">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
          {{ isEditMode() ? 'Guardar cambios' : 'Agregar objetivo' }}
        </button>
      </div>
    </div>
  </div>
}
