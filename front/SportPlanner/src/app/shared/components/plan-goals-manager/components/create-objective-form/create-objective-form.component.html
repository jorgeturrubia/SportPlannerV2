<form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-6">
  <!-- Name -->
  <div class="space-y-2">
    <label class="flex items-center text-sm font-medium text-slate-700 dark:text-slate-300">
      <span>Nombre *</span>
      @if (hasError('name', 'required')) {
        <span class="ml-2 text-xs text-red-500">Requerido</span>
      }
      @if (hasError('name', 'minlength')) {
        <span class="ml-2 text-xs text-red-500">Mínimo 3 caracteres</span>
      }
    </label>
    <input
      type="text"
      formControlName="name"
      placeholder="Ej: Cambio de mano rápido"
      class="w-full px-3 py-2 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-md shadow-sm text-slate-900 dark:text-white placeholder:text-slate-400 dark:placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent transition-colors"
      [class.ring-2]="hasError('name', 'required') || hasError('name', 'minlength')"
      [class.ring-red-500]="hasError('name', 'required') || hasError('name', 'minlength')" />
  </div>

  <!-- Description -->
  <div class="space-y-2">
    <label class="flex items-center text-sm font-medium text-slate-700 dark:text-slate-300">
      <span>Descripción</span>
    </label>
    <textarea
      formControlName="description"
      placeholder="Describe el objetivo en detalle (opcional)"
      rows="3"
      class="w-full px-3 py-2 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-md shadow-sm text-slate-900 dark:text-white placeholder:text-slate-400 dark:placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent transition-colors resize-none"></textarea>
  </div>

  <!-- Category (Main Select) -->
  <div class="space-y-2">
    <label class="flex items-center text-sm font-medium text-slate-700 dark:text-slate-300">
      <span>Categoría *</span>
      @if (hasError('objectiveCategoryId', 'required')) {
        <span class="ml-2 text-xs text-red-500">Requerido</span>
      }
    </label>
    <select
      formControlName="objectiveCategoryId"
      class="w-full px-3 py-2 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-md shadow-sm text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent transition-colors cursor-pointer"
      [class.ring-2]="hasError('objectiveCategoryId', 'required')"
      [class.ring-red-500]="hasError('objectiveCategoryId', 'required')">
      <option value="">-- Selecciona una categoría --</option>
      @for (cat of categories; track cat.id) {
        <option [value]="cat.id">{{ cat.name }}</option>
      }
    </select>
  </div>

  <!-- Subcategory (Dynamic - Reactive to Category Selection) -->
  <div class="space-y-2">
    <label class="flex items-center text-sm font-medium text-slate-700 dark:text-slate-300">
      <span>Subcategoría</span>
    </label>
    <select
      formControlName="objectiveSubcategoryId"
      [disabled]="!selectedCategoryId()"
      class="w-full px-3 py-2 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-md shadow-sm text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent transition-colors disabled:opacity-50 disabled:cursor-not-allowed disabled:bg-slate-100 dark:disabled:bg-slate-700"
      [class.cursor-pointer]="selectedCategoryId()">
      @if (!selectedCategoryId()) {
        <option value="">-- Selecciona una categoría primero --</option>
      } @else {
        <option value="">-- Sin subcategoría --</option>
        @for (sub of subcategories(); track sub.id) {
          <option [value]="sub.id">{{ sub.name }}</option>
        }
      }
    </select>
    @if (!selectedCategoryId()) {
      <p class="text-xs text-slate-500 dark:text-slate-400">Selecciona una categoría para ver las subcategorías disponibles</p>
    }
  </div>

  <!-- Level -->
  <div class="space-y-2">
    <label class="flex items-center text-sm font-medium text-slate-700 dark:text-slate-300">
      <span>Nivel</span>
    </label>
    <select
      formControlName="level"
      class="w-full px-3 py-2 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-md shadow-sm text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent transition-colors cursor-pointer">
      @for (level of objectiveLevels; track level.value) {
        <option [value]="level.value">{{ level.label }}</option>
      }
    </select>
  </div>

  <!-- Form Actions -->
  <div class="flex justify-end gap-3 pt-4 border-t border-slate-200 dark:border-slate-700">
    <button
      type="button"
      (click)="onCancel()"
      class="px-4 py-2 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 border border-slate-300 dark:border-slate-600 rounded-md hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors font-medium">
      Cancelar
    </button>
    <button
      type="submit"
      [disabled]="!isFormValid() || isSubmitting"
      class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors font-medium">
      @if (isSubmitting) {
        <span>Creando...</span>
      } @else {
        <span>Crear Objetivo</span>
      }
    </button>
  </div>
</form>
